<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LuaCsForBarotrauma: Assembly CSharp Mod</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="LuaCsForBarotrauma"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LuaCsForBarotrauma
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,true,'search.html','Search');
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_manual_assemblymod.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Assembly CSharp Mod </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>One type of CSharp mod that can be created is an assembly mod. This type of mod is compiled into a .dll file and requires the distribution of dll files.</p>
<p>Assembly mods can be debugged in your favourite IDE and take full advantage of the entire .NET ecosystem. They take an initial effort to set up, but can be more powerful and flexible.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Getting Started</h1>
<hr  />
<h2><a class="anchor" id="autotoc_md3"></a>
1. IDE Setup</h2>
<p>You will need an IDE that supports <code>.NET 6</code> as a platform/SDK target. Visual Studio 2022 is recommended. You can download it <a href="https://visualstudio.microsoft.com/vs/">here</a>. Other IDEs like JetBrains Rider also work, but there is no guarantee that the project will function as expected, although there should be little issue.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
2. Project skeleton</h2>
<p>Download or clone the following repository <a href="https://github.com/MapleWheels/VSProjectSkeleton">https://github.com/MapleWheels/VSProjectSkeleton</a>, this contains the skeleton project that we will be using as the basis for this tutorial. Most things that need to be setup have already been done.</p><ul>
<li>If you do not have Git Tools installed, it is recommended that you get familiar with them as it makes life easier. <a href="https://git-scm.com/downloads">Download and install it</a>.</li>
</ul>
<p>Make sure to extract the contents of the repository to a folder that you can easily access if you decided to manually download the zip file from github. You may also rename the directory to the name of your mod if you want.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
3. Reference dlls</h2>
<p>You also need to download the publicized reference dlls from <a href="https://github.com/evilfactory/LuaCsForBarotrauma/releases/download/latest/luacsforbarotrauma_refs.zip">https://github.com/evilfactory/LuaCsForBarotrauma/releases/download/latest/luacsforbarotrauma_refs.zip</a>. This contains the publicized reference dlls that are required to build the project.</p>
<p>After downloading the zip file, extract the contents to the <code>Refs</code> folder in project skeleton directory. The directory structure should look like this:</p>
<div class="fragment"><div class="line">./Refs</div>
<div class="line">----/Linux/Barotrauma.dll</div>
<div class="line">----/Linux/DedicatedServer.dll</div>
<div class="line">----/Linux/BarotraumaCore.dll</div>
<div class="line">----/Windows/Barotrauma.dll</div>
<div class="line">----/Windows/DedicatedServer.dll</div>
<div class="line">----/Windows/BarotraumaCore.dll</div>
<div class="line">...other files</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
4. Setup the project</h2>
<p>First rename the <code>MyModName.sln</code> file to the name of your mod. IE: <code>ExampleMod.sln</code>.</p>
<p>Then open up the Solution file (<code>.sln</code>) from the Skeleton Project in Visual Studio. Just verify that there are not errors related to "Unable to find Reference", this means that all assemblies in <code>/Refs</code> have be found successfully.</p>
<p>After that, in your IDE, you will need to do the following for all <code>.csproj</code> files: </p><div class="fragment"><div class="line">- LinuxClient.csproj</div>
<div class="line">- LinuxServer.csproj</div>
<div class="line">- OSXClient.csproj</div>
<div class="line">- OSXServer.csproj</div>
<div class="line">- WindowsClient.csproj</div>
<div class="line">- WindowsServer.csproj</div>
</div><!-- fragment --><ul>
<li>1. Open the Project Configuration for the <code>.csproj</code> file by right-clicking and selecting <code>Properties</code>.</li>
<li>2. Change the <code>AssemblyName</code> to the name of your mod WITHOUT SPACES OR SPECIAL CHARACTERS. Example: <code>SampleMod</code></li>
<li>3. Change the <code>Root Namespace</code> to either your mod's Assembly Name or mod's short version without spaces in plain English. Example: <code>SampleMod</code>.</li>
</ul>
<p>Note: If you do not want either the <code>Client</code> plugin or the <code>Server</code> plugin (IE. Client-side or Server-side ONLY mod), then you must delete all projects that end with <code>Server</code>. Example: <code>LinuxServer</code>, <code>WindowsServer</code>. Warning, this is generally irreversible and will require you to setup new Cs Projects if you want a client in the future.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
5. Setting up MSBuild to Copy Files into Local Mods.</h2>
<p>You will have to do the following for the <code>Build.props</code> file found in the main project directory:</p>
<ol type="1">
<li>Open the file in your Text Editor or IDE of choice.</li>
<li>Locate the line <code>ModDeployDir</code>, IE: <div class="fragment"><div class="line">&lt;<span class="keywordtype">PropertyGroup</span>&gt;</div>
<div class="line">    <span class="comment">&lt;!-- IMPORTANT: Should point to &lt;Barotrauma_Install&gt;\LocalMods&lt;MyModName&gt;\ --&gt;</span></div>
<div class="line">    <span class="comment">&lt;!-- IMPORTANT: ModDeplyDir Path must end with &#39;\&#39; --&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">ModDeployDir</span>&gt;..\<span class="keyword">LUATRAMA_DEBUG_LOCALMODS_MYMODDIR</span>\&lt;/<span class="keywordtype">ModDeployDir</span>&gt;</div>
<div class="line">    <span class="comment">&lt;!-- IMPORTANT: Avoid the use of special (IE: / : ; , \ &lt; &gt; ?) (periods &quot;.&quot; are good) and non-english characters in the AssemblyName.--&gt;</span></div>
<div class="line">    &lt;<span class="keywordtype">AssemblyName</span>&gt;<span class="keyword">MyModName</span>&lt;/<span class="keywordtype">AssemblyName</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">PropertyGroup</span>&gt;</div>
</div><!-- fragment --></li>
<li>Change the <code>ModDeployDir</code> value from <code>..\LUATRAMA_DEBUG_LOCALMODS_MYMODDIR\</code> to the path of your Barotrauma installation's <code>LocalMods</code> directory. IE: <code>C:\Program Files (x86)\Steam\steamapps\common\Barotrauma\LocalMods\MyModName\</code>.</li>
</ol>
<ul>
<li>IMPORTANT: The value must end with <code>/</code> or <code>\</code> . IE: <code>...\LocalMods\ModdingToolkit\</code>.</li>
</ul>
<ol type="1">
<li>Replace <code>MyModName</code> with a valid assembly name, this should be similar to your mod name but does not need to match. This name should:</li>
</ol>
<ul>
<li>Not include spaces.</li>
<li>Not include special characters except periods ( . ), which are allowed.</li>
<li>Use english characters.</li>
<li>Recommended: Follow the convention of <code>ModName</code> or <code>PackageName.LibraryName</code> for libraries, IE: <code>ModdingToolkit.GUI</code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md8"></a>
6. Wrapping up</h2>
<p>After setting up the project, you can start coding your mod. The project is already set up to build the mod into the <code>LocalMods</code> directory of your Barotrauma installation. You can now build the project and the mod dll files will be copied to the <code>LocalMods</code> directory.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Extras</h1>
<hr  />
<h2><a class="anchor" id="autotoc_md11"></a>
Setting up a debug build of LuaCsForBarotrauma</h2>
<p>This will give us a debug build of LuaCsForBarotrauma. A debug build gives us access to many tools as well as the <code>DEBUG</code> symbol for writing test/print code that will not be run in the release version.</p>
<ol type="1">
<li>Clone the <a href="https://github.com/evilfactory/LuaCsForBarotrauma">LuaCsForBarotrauma</a> repository to your local drive. If you do not have Git Tools installed, please <a href="https://git-scm.com/downloads">download and install it</a>.</li>
</ol>
<ul>
<li>Important: When cloning, use the command <code>git clone --recurse-submodules --remote-submodules <a href="https://github.com/evilfactory/LuaCsForBarotrauma.git">https://github.com/evilfactory/LuaCsForBarotrauma.git</a></code>. This will download the submodules automatically.</li>
</ul>
<ol type="1">
<li>Open up the LuaCs Solution in your IDE based on your Operating System, one of: <div class="fragment"><div class="line">- WindowsSolution.sln</div>
<div class="line">- MacSolution.sln</div>
<div class="line">- LinuxSolution.sln</div>
</div><!-- fragment --> &ndash; NOTE: This assumes that you are using the <code>WindowsSolution.sln</code>. For other platforms, the naming of files may be slightly different (MacXXX, LinuxXXX, where 'XXX' is either "Client" or "Server").</li>
<li>In the Project Settings for <code>WindowsClient</code> and <code>WindowsServer</code>, you want to change the <code>Platform Target</code> from <code>Any CPU</code> to <code>x64</code>. This is necessary for OpenAL code to build successfully.</li>
<li>Build the whole Solution (<code>Build -&gt; Build Solution</code>). This will create the necessary dependencies from libraries and make sure that there are no errors at this point.\</li>
<li>For both the <code>WindowsClient</code> and <code>WindowsServer</code> projects, set their output/build type to <code>DEBUG</code> (should be in a drop-down menu at the top next to a green play button).\</li>
<li>Select <code>Build Solution</code>. This will generate Debug builds for use. This debug build will now exist in <code>./Barotrauma/bin/DebugXXX/net6.0/</code> where <code>XXX</code> is based on your Solution choice. IE. <code>./Barotrauma/bin/DebugWindows/net6.0</code>.</li>
</ol>
<p>Now instead of using your Barotrauma steam installation, you can use the debug build of LuaCsForBarotrauma to test your mods. Simply put your mod in the <code>LocalMods</code> directory of the debug build and set the ModDeployDir in the <code>Build.props</code> file. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
